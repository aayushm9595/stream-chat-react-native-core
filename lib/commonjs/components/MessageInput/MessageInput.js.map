{"version":3,"sources":["MessageInput.tsx"],"names":["iconClose","require","Container","styled","View","imageUploads","theme","length","messageInput","container","conditionalPadding","css","EditingBoxContainer","editingBoxContainer","EditingBoxHeader","editingBoxHeader","EditingBoxHeaderTitle","Text","editingBoxHeaderTitle","InputBoxContainer","inputBoxContainer","MessageInput","props","ActionSheetAttachment","ActionSheetAttachmentDefault","actionSheetStyles","additionalTextInputProps","AttachButton","AttachButtonDefault","AttachmentFileIcon","compressImageQuality","disabledProp","disabled","doDocUploadRequest","doImageUploadRequest","FileUploadPreview","FileUploadPreviewDefault","hasFilePicker","hasImagePicker","ImageUploadPreview","ImageUploadPreviewDefault","initialValue","autocompleteSuggestionsLimit","Input","maxNumberOfFiles","onChangeTextProp","onChangeText","parent_id","SendButton","SendButtonDefault","sendImageAsync","setInputRef","channel","disabledContext","members","watchers","client","clearEditingState","editing","editMessage","sendMessageContext","sendMessage","setInputBoxContainerRef","t","attachActionSheet","inputBoxRef","sending","asyncIds","setAsyncIds","asyncUploads","setAsyncUploads","fileUploads","mentionedUsers","numberOfUploads","setFileUploads","setImageUploads","setMentionedUsers","setNumberOfUploads","setText","text","current","focus","resetInput","sendMessageAsync","id","image","state","FileState","UPLOAD_FAILED","UPLOADED","attachments","image_url","url","type","mentioned_users","prevAsyncIds","splice","indexOf","prevAsyncUploads","prevNumberOfUploads","_error","console","log","Object","keys","forEach","appendText","newText","prevText","closeAttachActionSheet","hide","getMembers","result","values","member","push","user","getUsers","users","getWatchers","uniqueUsers","usersArray","isValidMessage","UPLOADING","file","keystroke","onSelectItem","item","prevMentionedUsers","pickFile","cancelled","docs","doc","mimeType","name","startsWith","uploadNewImage","uploadNewFile","pickImage","images","removeFile","some","prevFileUploads","filter","removeImage","prevImageUploads","handleOnPress","Keyboard","dismiss","show","renderInputContainer","additionalTextInputContainerProps","editable","undefined","triggerSettings","onMentionSelectItem","uploadFile","uploadImage","setAttachActionSheetRef","setInputBoxRef","updateMessage","pendingAttachments","clear","FINISHED","fallback","asset_url","file_size","size","mime_type","title","updatedMessage","updateMessagePromise","then","ref","newFile","map","fileUpload","response","uri","sendFile","warn","newImage","filename","replace","contentType","sendImage","res","includes","imageUpload","Promise","all","concat"],"mappings":"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","sourcesContent":["import React, { useEffect, useRef, useState } from 'react';\nimport {\n  ImageRequireSource,\n  Keyboard,\n  TextInput,\n  TextInputProps,\n  View,\n} from 'react-native';\nimport uniq from 'lodash/uniq';\nimport { lookup } from 'mime-types';\nimport {\n  Attachment,\n  logChatPromiseExecution,\n  SendFileAPIResponse,\n  Message as StreamMessage,\n  UpdatedMessage,\n  UserResponse,\n} from 'stream-chat';\n\nimport {\n  ActionSheetAttachment as ActionSheetAttachmentDefault,\n  ActionSheetProps,\n  ActionSheetStyles,\n} from './ActionSheetAttachment';\nimport {\n  AttachButton as AttachButtonDefault,\n  AttachButtonProps,\n} from './AttachButton';\nimport {\n  FileUploadPreview as FileUploadPreviewDefault,\n  FileUploadPreviewProps,\n} from './FileUploadPreview';\nimport {\n  ImageUploadPreview as ImageUploadPreviewDefault,\n  ImageUploadPreviewProps,\n} from './ImageUploadPreview';\nimport { SendButton as SendButtonDefault, SendButtonProps } from './SendButton';\n\nimport {\n  FileUpload,\n  ImageUpload,\n  useMessageDetailsForState,\n} from './hooks/useMessageDetailsForState';\nimport { generateRandomId } from '../../utils/generateRandomId';\n\nimport {\n  AutoCompleteInput,\n  AutoCompleteInputProps,\n} from '../AutoCompleteInput/AutoCompleteInput';\nimport { IconSquare } from '../IconSquare';\n\nimport {\n  ChannelContextValue,\n  useChannelContext,\n} from '../../contexts/channelContext/ChannelContext';\nimport { useChatContext } from '../../contexts/chatContext/ChatContext';\nimport {\n  isEditingBoolean,\n  useMessagesContext,\n} from '../../contexts/messagesContext/MessagesContext';\nimport { useSuggestionsContext } from '../../contexts/suggestionsContext/SuggestionsContext';\nimport { useTranslationContext } from '../../contexts/translationContext/TranslationContext';\nimport { pickDocument, pickImage as pickImageNative } from '../../native';\nimport { styled } from '../../styles/styledComponents';\nimport {\n  ACITriggerSettings,\n  FileState,\n  TriggerSettings,\n} from '../../utils/utils';\n\nimport type { ActionSheetCustom } from 'react-native-actionsheet';\n\nimport type { FileIconProps } from '../Attachment/FileIcon';\nimport type {\n  DefaultAttachmentType,\n  DefaultChannelType,\n  DefaultCommandType,\n  DefaultEventType,\n  DefaultMessageType,\n  DefaultReactionType,\n  DefaultUserType,\n  UnknownType,\n} from '../../types/types';\n\nconst iconClose: ImageRequireSource = require('../../images/icons/icon_close.png');\n\nconst Container = styled.View<{ imageUploads: ImageUpload[] }>`\n  background-color: rgba(0, 0, 0, 0.05);\n  border-radius: 10px;\n  margin-horizontal: 10px;\n  padding-top: ${({ imageUploads, theme }) =>\n    imageUploads && imageUploads.length\n      ? theme.messageInput.container.conditionalPadding\n      : 0}px;\n  ${({ theme }) => theme.messageInput.container.css};\n`;\n\nconst EditingBoxContainer = styled.View`\n  background-color: white;\n  padding-horizontal: 0px;\n  shadow-color: grey;\n  shadow-opacity: 0.5;\n  z-index: 100;\n  ${({ theme }) => theme.messageInput.editingBoxContainer.css};\n`;\n\nconst EditingBoxHeader = styled.View`\n  align-items: center;\n  flex-direction: row;\n  justify-content: space-between;\n  padding: 10px;\n  ${({ theme }) => theme.messageInput.editingBoxHeader.css};\n`;\n\nconst EditingBoxHeaderTitle = styled.Text`\n  font-weight: bold;\n  ${({ theme }) => theme.messageInput.editingBoxHeaderTitle.css};\n`;\n\n// have to wrap the react-native View because styled-components don't work well with ref setting\nconst InputBoxContainer = styled(View)`\n  align-items: center;\n  flex-direction: row;\n  margin: 10px;\n  min-height: 46px;\n  padding-horizontal: 10px;\n  ${({ theme }) => theme.messageInput.inputBoxContainer.css};\n`;\n\nexport type MessageInputProps<\n  At extends UnknownType = DefaultAttachmentType,\n  Ch extends UnknownType = DefaultChannelType,\n  Co extends string = DefaultCommandType,\n  Ev extends UnknownType = DefaultEventType,\n  Me extends UnknownType = DefaultMessageType,\n  Re extends UnknownType = DefaultReactionType,\n  Us extends UnknownType = DefaultUserType\n> = {\n  /**\n   * Custom UI component for ActionSheetAttachment.\n   *\n   * Defaults to and accepts same props as: [ActionSheetAttachment](https://getstream.github.io/stream-chat-react-native/#actionsheetattachment)\n   */\n  ActionSheetAttachment?: React.ComponentType<ActionSheetProps>;\n  /**\n   * Style object for actionsheet (used for option to choose file attachment or photo attachment).\n   * Supported styles: https://github.com/beefe/react-native-actionsheet/blob/master/lib/styles.js\n   */\n  actionSheetStyles?: ActionSheetStyles;\n  /**\n   * Additional props for underlying TextInput component. These props will be forwarded as it is to TextInput component.\n   *\n   * @see See https://reactnative.dev/docs/textinput#reference\n   */\n  additionalTextInputProps?: TextInputProps;\n  /**\n   * Custom UI component for attach button.\n   *\n   * Defaults to and accepts same props as: [AttachButton](https://getstream.github.io/stream-chat-react-native/#attachbutton)\n   */\n  AttachButton?: React.ComponentType<AttachButtonProps>;\n  /**\n   * Custom UI component for attachment icon for type 'file' attachment in preview.\n   * Defaults to and accepts same props as: https://github.com/GetStream/stream-chat-react-native/blob/master/src/components/Attachment/FileIcon.tsx\n   */\n  AttachmentFileIcon?: React.ComponentType<FileIconProps>;\n  /**\n   * Max number of suggestions to display in list. Defaults to 10.\n   */\n  autocompleteSuggestionsLimit?: number;\n  /**\n   * Compress image with quality (from 0 to 1, where 1 is best quality).\n   * On iOS, values larger than 0.8 don't produce a noticeable quality increase in most images,\n   * while a value of 0.8 will reduce the file size by about half or less compared to a value of 1.\n   * Image picker defaults to 0.8 for iOS and 1 for Android\n   */\n  compressImageQuality?: number;\n  /**\n   * Override of context disabled for disabling input only\n   */\n  disabled?: boolean;\n  /**\n   * Override file upload request\n   *\n   * @param file    File object - { uri: '', name: '' }\n   * @param channel Current channel object\n   */\n  doDocUploadRequest?: (\n    file: {\n      name: string;\n      size?: string | number;\n      type?: string;\n      uri?: string;\n    },\n    channel: ChannelContextValue<At, Ch, Co, Ev, Me, Re, Us>['channel'],\n  ) => Promise<SendFileAPIResponse>;\n  /**\n   * Override image upload request\n   *\n   * @param file    File object - { uri: '' }\n   * @param channel Current channel object\n   */\n  doImageUploadRequest?: (\n    file: {\n      name?: string;\n      uri?: string;\n    },\n    channel: ChannelContextValue<At, Ch, Co, Ev, Me, Re, Us>['channel'],\n  ) => Promise<SendFileAPIResponse>;\n  /**\n   * Custom UI component for FileUploadPreview.\n   * Defaults to and accepts same props as: https://github.com/GetStream/stream-chat-react-native/blob/master/src/components/MessageInput/FileUploadPreview.tsx\n   */\n  FileUploadPreview?: React.ComponentType<FileUploadPreviewProps>;\n  /** If component should have file picker functionality */\n  hasFilePicker?: boolean;\n  /** If component should have image picker functionality */\n  hasImagePicker?: boolean;\n  ImageUploadPreview?: React.ComponentType<ImageUploadPreviewProps>;\n  /** Initial value to set on input */\n  initialValue?: string;\n\n  /**\n   * Custom UI component for AutoCompleteInput.\n   * Defaults to and accepts same props as: https://github.com/GetStream/stream-chat-react-native/blob/master/src/components/AutoCompleteInput/AutoCompleteInput.tsx\n   */\n  Input?: React.ComponentType<\n    AutoCompleteInputProps<Co, Us> & {\n      _pickFile: () => Promise<void>;\n      _pickImage: () => Promise<void>;\n      _removeFile: FileUploadPreviewProps['removeFile'];\n      _removeImage: ImageUploadPreviewProps['removeImage'];\n      _uploadFile: FileUploadPreviewProps['retryUpload'];\n      _uploadImage: ImageUploadPreviewProps['retryUpload'];\n      appendText: (newText: string) => void;\n      closeAttachActionSheet: () => void;\n      disabled: boolean;\n      getUsers: () => UserResponse<Us>[];\n      handleOnPress: () => Promise<void>;\n      isValidMessage: () => boolean;\n      onSelectItem: (item: UserResponse<Us>) => void;\n      sendMessage: () => Promise<void>;\n      setInputBoxContainerRef: (ref: View | null) => void;\n      updateMessage: () => Promise<void>;\n      uploadNewFile: (file: {\n        name: string;\n        size?: number | string;\n        type?: string;\n        uri?: string;\n      }) => Promise<void>;\n      uploadNewImage: (image: { uri?: string }) => Promise<void>;\n    }\n  >;\n  /** Limit on allowed number of files to attach at a time. */\n  maxNumberOfFiles?: number;\n  /**\n   * Callback that is called when the text input's text changes. Changed text is passed as a single string argument to the callback handler.\n   *\n   * @param newText\n   */\n  onChangeText?: (newText: string) => void;\n  /** Parent message id - in case of thread */\n  parent_id?: StreamMessage<At, Me, Us>['parent_id'];\n  /**\n   * Custom UI component for send button.\n   *\n   * Defaults to and accepts same props as: [SendButton](https://getstream.github.io/stream-chat-react-native/#sendbutton)\n   */\n  SendButton?: React.ComponentType<SendButtonProps>;\n  /**\n   * For images still in uploading state when user hits send, send text immediately and send image as follow-up message once uploaded\n   */\n  sendImageAsync?: boolean;\n  /**\n   * ref for input setter function\n   */\n  setInputRef?: (ref: TextInput | null) => void;\n};\n\n/**\n * UI Component for message input\n * It's a consumer of\n * [Channel Context](https://getstream.github.io/stream-chat-react-native/#channelcontext),\n * [Chat Context](https://getstream.github.io/stream-chat-react-native/#chatcontext),\n * [Messages Context](https://getstream.github.io/stream-chat-react-native/#messagescontext),\n * [Suggestions Context](https://getstream.github.io/stream-chat-react-native/#suggestionscontext), and\n * [Translation Context](https://getstream.github.io/stream-chat-react-native/#translationcontext)\n *\n * @example ./MessageInput.md\n */\nexport const MessageInput = <\n  At extends DefaultAttachmentType = DefaultAttachmentType,\n  Ch extends UnknownType = DefaultChannelType,\n  Co extends string = DefaultCommandType,\n  Ev extends UnknownType = DefaultEventType,\n  Me extends UnknownType = DefaultMessageType,\n  Re extends UnknownType = DefaultReactionType,\n  Us extends UnknownType = DefaultUserType\n>(\n  props: MessageInputProps<At, Ch, Co, Ev, Me, Re, Us>,\n) => {\n  const {\n    ActionSheetAttachment = ActionSheetAttachmentDefault,\n    actionSheetStyles,\n    additionalTextInputProps,\n    AttachButton = AttachButtonDefault,\n    AttachmentFileIcon,\n    compressImageQuality,\n    disabled: disabledProp,\n    doDocUploadRequest,\n    doImageUploadRequest,\n    FileUploadPreview = FileUploadPreviewDefault,\n    hasFilePicker = true,\n    hasImagePicker = true,\n    ImageUploadPreview = ImageUploadPreviewDefault,\n    initialValue,\n    autocompleteSuggestionsLimit = 10,\n    Input,\n    maxNumberOfFiles = 10,\n    onChangeText: onChangeTextProp,\n    parent_id,\n    SendButton = SendButtonDefault,\n    sendImageAsync = false,\n    setInputRef,\n  } = props;\n\n  const {\n    channel,\n    disabled: disabledContext = false,\n    members,\n    watchers,\n  } = useChannelContext<At, Ch, Co, Ev, Me, Re, Us>();\n\n  const disabled = disabledProp || disabledContext;\n\n  const { client } = useChatContext<At, Ch, Co, Ev, Me, Re, Us>();\n\n  const {\n    clearEditingState,\n    editing,\n    editMessage,\n    sendMessage: sendMessageContext,\n  } = useMessagesContext<At, Ch, Co, Ev, Me, Re, Us>();\n\n  const { setInputBoxContainerRef } = useSuggestionsContext<Co, Us>();\n\n  const { t } = useTranslationContext();\n\n  const attachActionSheet = useRef<ActionSheetCustom | null>(null);\n  const inputBoxRef = useRef<TextInput | null>(null);\n  const sending = useRef(false);\n\n  const [asyncIds, setAsyncIds] = useState<string[]>([]);\n  const [asyncUploads, setAsyncUploads] = useState<{\n    [key: string]: {\n      state: string;\n      url: string;\n    };\n  }>({});\n\n  const {\n    fileUploads,\n    imageUploads,\n    mentionedUsers,\n    numberOfUploads,\n    setFileUploads,\n    setImageUploads,\n    setMentionedUsers,\n    setNumberOfUploads,\n    setText,\n    text,\n  } = useMessageDetailsForState<At, Ch, Co, Ev, Me, Re, Us>(\n    editing,\n    initialValue,\n  );\n\n  useEffect(() => {\n    if (editing && inputBoxRef.current) {\n      inputBoxRef.current.focus();\n    }\n\n    if (!editing) {\n      resetInput();\n    }\n  }, [editing]);\n\n  const sendMessageAsync = (id: string) => {\n    const image = asyncUploads[id];\n    if (!image || image.state === FileState.UPLOAD_FAILED) {\n      return;\n    }\n\n    if (image.state === FileState.UPLOADED) {\n      const attachments = [\n        {\n          image_url: image.url,\n          type: 'image',\n        },\n      ] as StreamMessage<At, Me, Us>['attachments'];\n\n      try {\n        sendMessageContext(({\n          attachments,\n          mentioned_users: [],\n          parent_id,\n          text: '',\n        } as unknown) as Partial<StreamMessage<At, Me, Us>>);\n\n        setAsyncIds((prevAsyncIds) =>\n          prevAsyncIds.splice(prevAsyncIds.indexOf(id), 1),\n        );\n        setAsyncUploads((prevAsyncUploads) => {\n          delete prevAsyncUploads[id];\n          return prevAsyncUploads;\n        });\n\n        setNumberOfUploads((prevNumberOfUploads) => prevNumberOfUploads - 1);\n      } catch (_error) {\n        console.log('Failed');\n      }\n    }\n  };\n\n  useEffect(() => {\n    if (Object.keys(asyncUploads).length) {\n      /**\n       * When successful image upload response occurs after hitting send,\n       * send a follow up message with the image\n       */\n      sending.current = true;\n      asyncIds.forEach((id) => sendMessageAsync(id));\n      sending.current = false;\n    }\n  }, [asyncIds, asyncUploads, sending, sendMessageAsync]);\n\n  const appendText = (newText: string) => {\n    setText((prevText) => `${prevText}${newText}`);\n  };\n\n  const closeAttachActionSheet = () => {\n    if (attachActionSheet.current) {\n      /**\n       * Hide doesn't exist until we bump @types/react-native-actionsheet from this\n       * PR being merged: https://github.com/DefinitelyTyped/DefinitelyTyped/pull/48275\n       */\n      // @ts-expect-error\n      attachActionSheet.current.hide();\n    }\n  };\n\n  const getMembers = () => {\n    const result: UserResponse<Us>[] = [];\n    if (members && Object.values(members).length) {\n      Object.values(members).forEach((member) =>\n        result.push(member.user as UserResponse<Us>),\n      );\n    }\n\n    return result;\n  };\n\n  const getUsers = () => {\n    const users = [...getMembers(), ...getWatchers()];\n\n    // make sure we don't list users twice\n    const uniqueUsers: { [key: string]: UserResponse<Us> } = {};\n    for (const user of users) {\n      if (user && !uniqueUsers[user.id]) {\n        uniqueUsers[user.id] = user as UserResponse<Us>;\n      }\n    }\n    const usersArray = Object.values(uniqueUsers);\n\n    return usersArray;\n  };\n\n  const getWatchers = () => {\n    const result: UserResponse<Us>[] = [];\n    if (watchers && Object.values(watchers).length) {\n      result.push(...(Object.values(watchers) as UserResponse<Us>[]));\n    }\n\n    return result;\n  };\n\n  /** Checks if the message is valid or not. Accordingly we can enable/disable send button */\n  const isValidMessage = () => {\n    if (text) {\n      return true;\n    }\n\n    for (const image of imageUploads) {\n      if (!image || image.state === FileState.UPLOAD_FAILED) {\n        continue;\n      }\n      if (image.state === FileState.UPLOADING) {\n        // TODO: show error to user that they should wait until image is uploaded\n        return false;\n      }\n\n      return true;\n    }\n\n    for (const file of fileUploads) {\n      if (!file || file.state === FileState.UPLOAD_FAILED) {\n        continue;\n      }\n      if (file.state === FileState.UPLOADING) {\n        // TODO: show error to user that they should wait until image is uploaded\n        return false;\n      }\n\n      return true;\n    }\n\n    return false;\n  };\n\n  const onChangeText = (newText: string) => {\n    if (sending.current) {\n      return;\n    }\n    setText(newText);\n\n    if (newText && channel) {\n      logChatPromiseExecution(channel.keystroke(), 'start typing event');\n    }\n\n    if (onChangeTextProp) {\n      onChangeTextProp(newText);\n    }\n  };\n\n  const onSelectItem = (item: UserResponse<Us>) => {\n    setMentionedUsers((prevMentionedUsers) => [...prevMentionedUsers, item.id]);\n  };\n\n  const pickFile = async () => {\n    if (maxNumberOfFiles && numberOfUploads >= maxNumberOfFiles) {\n      return;\n    }\n\n    const result = await pickDocument({\n      maxNumberOfFiles: maxNumberOfFiles - numberOfUploads,\n    });\n    if (!result.cancelled && result.docs) {\n      result.docs.forEach((doc) => {\n        const mimeType = lookup(doc.name);\n\n        if (mimeType && mimeType?.startsWith('image/')) {\n          uploadNewImage(doc);\n        } else {\n          uploadNewFile(doc);\n        }\n      });\n    }\n  };\n\n  const pickImage = async () => {\n    if (maxNumberOfFiles && numberOfUploads >= maxNumberOfFiles) {\n      return;\n    }\n\n    const result = await pickImageNative({\n      compressImageQuality,\n      maxNumberOfFiles: maxNumberOfFiles - numberOfUploads,\n    });\n\n    if (!result.cancelled && result.images) {\n      result.images.forEach((image) => {\n        uploadNewImage(image);\n      });\n    }\n  };\n\n  const removeFile = (id: string) => {\n    if (fileUploads.some((file) => file.id === id)) {\n      setFileUploads((prevFileUploads) =>\n        prevFileUploads.filter((file) => file.id !== id),\n      );\n      setNumberOfUploads((prevNumberOfUploads) => prevNumberOfUploads - 1);\n    }\n  };\n\n  const removeImage = (id: string) => {\n    if (imageUploads.some((image) => image.id === id)) {\n      setImageUploads((prevImageUploads) =>\n        prevImageUploads.filter((image) => image.id !== id),\n      );\n      setNumberOfUploads((prevNumberOfUploads) => prevNumberOfUploads - 1);\n    }\n  };\n\n  const handleOnPress = async () => {\n    if (\n      (maxNumberOfFiles && numberOfUploads >= maxNumberOfFiles) ||\n      numberOfUploads >= 10\n    ) {\n      return;\n    }\n\n    if (hasImagePicker) {\n      if (hasFilePicker) {\n        await Keyboard.dismiss();\n        if (attachActionSheet?.current) {\n          attachActionSheet.current.show();\n        }\n      } else {\n        pickImage();\n      }\n    } else if (hasFilePicker) {\n      pickFile();\n    }\n  };\n\n  const renderInputContainer = () => {\n    const additionalTextInputContainerProps = {\n      editable: disabled ? false : undefined,\n      ...additionalTextInputProps,\n    };\n\n    const triggerSettings = channel\n      ? ACITriggerSettings<At, Ch, Co, Ev, Me, Re, Us>({\n          autocompleteSuggestionsLimit,\n          channel,\n          onMentionSelectItem: onSelectItem,\n          t,\n        })\n      : ({} as TriggerSettings<Co, Us>);\n\n    return (\n      <Container imageUploads={imageUploads}>\n        {fileUploads && (\n          <FileUploadPreview\n            AttachmentFileIcon={AttachmentFileIcon}\n            fileUploads={fileUploads}\n            removeFile={removeFile}\n            retryUpload={uploadFile}\n          />\n        )}\n        {imageUploads && (\n          <ImageUploadPreview\n            imageUploads={imageUploads}\n            removeImage={removeImage}\n            retryUpload={uploadImage}\n          />\n        )}\n\n        {/**\n         * TODO: Use custom action sheet to show icon with titles of button. But it doesn't\n         * work well with async onPress operations. So find a solution.\n         */}\n        <ActionSheetAttachment\n          closeAttachActionSheet={closeAttachActionSheet}\n          pickFile={pickFile}\n          pickImage={pickImage}\n          setAttachActionSheetRef={setAttachActionSheetRef}\n          styles={actionSheetStyles}\n        />\n        <InputBoxContainer ref={setInputBoxContainerRef}>\n          {Input ? (\n            <Input\n              _pickFile={pickFile}\n              _pickImage={pickImage}\n              _removeFile={removeFile}\n              _removeImage={removeImage}\n              _uploadFile={uploadFile}\n              _uploadImage={uploadImage}\n              additionalTextInputProps={additionalTextInputContainerProps}\n              appendText={appendText}\n              closeAttachActionSheet={closeAttachActionSheet}\n              disabled={disabled}\n              getUsers={getUsers}\n              handleOnPress={handleOnPress}\n              isValidMessage={isValidMessage}\n              onChange={onChangeText}\n              onSelectItem={onSelectItem}\n              sendMessage={sendMessage}\n              setInputBoxContainerRef={setInputBoxContainerRef}\n              setInputBoxRef={setInputBoxRef}\n              triggerSettings={triggerSettings}\n              updateMessage={updateMessage}\n              uploadNewFile={uploadNewFile}\n              uploadNewImage={uploadNewImage}\n              value={text}\n            />\n          ) : (\n            <>\n              {(hasImagePicker || hasFilePicker) && (\n                <AttachButton\n                  disabled={disabled}\n                  handleOnPress={handleOnPress}\n                />\n              )}\n              <AutoCompleteInput<Co, Us>\n                additionalTextInputProps={additionalTextInputProps || {}}\n                onChange={onChangeText}\n                setInputBoxRef={setInputBoxRef}\n                triggerSettings={triggerSettings}\n                value={text}\n              />\n              <SendButton<At, Ch, Co, Ev, Me, Re, Us>\n                disabled={disabled || sending.current || !isValidMessage()}\n                sendMessage={sendMessage}\n              />\n            </>\n          )}\n        </InputBoxContainer>\n      </Container>\n    );\n  };\n  const resetInput = (pendingAttachments: Attachment[] = []) => {\n    setFileUploads([]);\n    setImageUploads([]);\n    setMentionedUsers([]);\n    setNumberOfUploads(\n      (prevNumberOfUploads) =>\n        prevNumberOfUploads - (pendingAttachments?.length || 0),\n    );\n    setText('');\n  };\n\n  const sendMessage = async () => {\n    if (sending.current) {\n      return;\n    }\n    sending.current = true;\n\n    const prevText = text;\n    await setText('');\n    if (inputBoxRef.current) {\n      inputBoxRef.current.clear();\n    }\n\n    const attachments = [] as Array<Attachment<At>>;\n    for (const image of imageUploads) {\n      if (!image || image.state === FileState.UPLOAD_FAILED) {\n        continue;\n      }\n\n      if (image.state === FileState.UPLOADING) {\n        // TODO: show error to user that they should wait until image is uploaded\n        if (sendImageAsync) {\n          /**\n           * If user hit send before image uploaded, push ID into a queue to later\n           * be matched with the successful CDN response\n           */\n          setAsyncIds((prevAsyncIds) => [...prevAsyncIds, image.id]);\n        } else {\n          sending.current = false;\n          return setText(prevText);\n        }\n      }\n\n      if (\n        image.state === FileState.UPLOADED ||\n        image.state === FileState.FINISHED\n      ) {\n        attachments.push({\n          fallback: image.file.name,\n          image_url: image.url,\n          type: 'image',\n        } as Attachment<At>);\n      }\n    }\n\n    for (const file of fileUploads) {\n      if (!file || file.state === FileState.UPLOAD_FAILED) {\n        continue;\n      }\n      if (file.state === FileState.UPLOADING) {\n        // TODO: show error to user that they should wait until image is uploaded\n        sending.current = false;\n        return;\n      }\n      if (\n        file.state === FileState.UPLOADED ||\n        file.state === FileState.FINISHED\n      ) {\n        attachments.push({\n          asset_url: file.url,\n          file_size: file.file.size,\n          mime_type: file.file.type,\n          title: file.file.name,\n          type: 'file',\n        } as Attachment<At>);\n      }\n    }\n\n    // Disallow sending message if its empty.\n    if (!prevText && attachments.length === 0) {\n      sending.current = false;\n      return;\n    }\n\n    if (editing && !isEditingBoolean(editing)) {\n      const updatedMessage = {\n        ...editing,\n        attachments,\n        mentioned_users: mentionedUsers,\n        text: prevText,\n      } as UpdatedMessage<At, Ch, Co, Me, Re, Us>;\n\n      // TODO: Remove this line and show an error when submit fails\n      clearEditingState();\n      const updateMessagePromise = editMessage(updatedMessage).then(\n        clearEditingState,\n      );\n      resetInput(attachments);\n      logChatPromiseExecution(updateMessagePromise, 'update message');\n\n      sending.current = false;\n    } else {\n      try {\n        sendMessageContext(({\n          attachments,\n          mentioned_users: uniq(mentionedUsers),\n          parent_id,\n          text: prevText,\n        } as unknown) as StreamMessage<At, Me, Us>);\n\n        sending.current = false;\n        resetInput(attachments);\n      } catch (_error) {\n        sending.current = false;\n        setText(prevText);\n        console.log('Failed to send message');\n      }\n    }\n  };\n\n  const setAttachActionSheetRef = (ref: ActionSheetCustom | null) => {\n    attachActionSheet.current = ref;\n  };\n\n  const setInputBoxRef = (ref: TextInput | null) => {\n    inputBoxRef.current = ref;\n    if (setInputRef) {\n      setInputRef(ref);\n    }\n  };\n\n  const updateMessage = async () => {\n    try {\n      if (!isEditingBoolean(editing)) {\n        await client.updateMessage({\n          ...editing,\n          text,\n        } as UpdatedMessage<At, Ch, Co, Me, Re, Us>);\n      }\n\n      resetInput();\n      clearEditingState();\n    } catch (error) {\n      console.log(error);\n    }\n  };\n\n  const uploadFile = async ({ newFile }: { newFile: FileUpload }) => {\n    if (!newFile) {\n      return;\n    }\n    const { file, id } = newFile;\n\n    await setFileUploads((prevFileUploads) =>\n      prevFileUploads.map((fileUpload) => {\n        if (fileUpload.id === id) {\n          return {\n            ...fileUpload,\n            state: FileState.UPLOADING,\n          };\n        }\n        return fileUpload;\n      }),\n    );\n\n    let response = {} as SendFileAPIResponse;\n    try {\n      if (doDocUploadRequest) {\n        response = await doDocUploadRequest(file, channel);\n      } else if (channel && file.uri) {\n        response = await channel.sendFile(file.uri, file.name, file.type);\n      }\n    } catch (error) {\n      console.warn(error);\n      if (!newFile) {\n        setNumberOfUploads((prevNumberOfUploads) => prevNumberOfUploads - 1);\n      } else {\n        setFileUploads((prevFileUploads) =>\n          prevFileUploads.map((fileUpload) => {\n            if (fileUpload.id === id) {\n              return {\n                ...fileUpload,\n                state: FileState.UPLOAD_FAILED,\n              };\n            }\n            return fileUpload;\n          }),\n        );\n        setNumberOfUploads((prevNumberOfUploads) => prevNumberOfUploads - 1);\n      }\n      return;\n    }\n\n    setFileUploads((prevFileUploads) =>\n      prevFileUploads.map((fileUpload) => {\n        if (fileUpload.id === id) {\n          return {\n            ...fileUpload,\n            state: FileState.UPLOADED,\n            url: response.file,\n          };\n        }\n        return fileUpload;\n      }),\n    );\n  };\n\n  const uploadImage = async ({ newImage }: { newImage: ImageUpload }) => {\n    const { file, id } = newImage || {};\n    if (!file) {\n      return;\n    }\n\n    let response = {} as SendFileAPIResponse;\n\n    const filename = (file.name || file.uri || '').replace(\n      /^(file:\\/\\/|content:\\/\\/)/,\n      '',\n    );\n    const contentType = lookup(filename) || 'multipart/form-data';\n\n    try {\n      if (doImageUploadRequest) {\n        response = await doImageUploadRequest(file, channel);\n      } else if (file.uri && channel) {\n        if (sendImageAsync) {\n          channel.sendImage(file.uri, undefined, contentType).then((res) => {\n            if (asyncIds.includes(id)) {\n              // Evaluates to true if user hit send before image successfully uploaded\n              setAsyncUploads((prevAsyncUploads) => {\n                prevAsyncUploads[id] = {\n                  ...prevAsyncUploads[id],\n                  state: FileState.UPLOADED,\n                  url: res.file,\n                };\n                return prevAsyncUploads;\n              });\n            } else {\n              setImageUploads((prevImageUploads) =>\n                prevImageUploads.map((imageUpload) => {\n                  if (imageUpload.id === id) {\n                    return {\n                      ...imageUpload,\n                      state: FileState.UPLOADED,\n                      url: res.file,\n                    };\n                  }\n                  return imageUpload;\n                }),\n              );\n            }\n          });\n        } else {\n          response = await channel.sendImage(file.uri, undefined, contentType);\n        }\n      }\n\n      if (Object.keys(response).length) {\n        setImageUploads((prevImageUploads) =>\n          prevImageUploads.map((imageUpload) => {\n            if (imageUpload.id === id) {\n              return {\n                ...imageUpload,\n                state: FileState.UPLOADED,\n                url: response.file,\n              };\n            }\n            return imageUpload;\n          }),\n        );\n      }\n    } catch (error) {\n      console.warn(error);\n      if (newImage) {\n        setImageUploads((prevImageUploads) =>\n          prevImageUploads.map((imageUpload) => {\n            if (imageUpload.id === id) {\n              return {\n                ...imageUpload,\n                state: FileState.UPLOAD_FAILED,\n              };\n            }\n            return imageUpload;\n          }),\n        );\n      }\n      setNumberOfUploads((prevNumberOfUploads) => prevNumberOfUploads - 1);\n\n      return;\n    }\n  };\n\n  const uploadNewFile = async (file: {\n    name: string;\n    size?: number | string;\n    type?: string;\n    uri?: string;\n  }) => {\n    const id = generateRandomId();\n    const mimeType = lookup(file.name);\n    const newFile = {\n      file: { ...file, type: mimeType || file?.type },\n      id,\n      state: FileState.UPLOADING,\n    };\n    await Promise.all([\n      setFileUploads((prevFileUploads) => prevFileUploads.concat([newFile])),\n      setNumberOfUploads((prevNumberOfUploads) => prevNumberOfUploads + 1),\n    ]);\n\n    uploadFile({ newFile });\n  };\n\n  const uploadNewImage = async (image: { uri?: string }) => {\n    const id = generateRandomId();\n    const newImage = {\n      file: image,\n      id,\n      state: FileState.UPLOADING,\n    };\n    await Promise.all([\n      setImageUploads((prevImageUploads) =>\n        prevImageUploads.concat([newImage]),\n      ),\n      setNumberOfUploads((prevNumberOfUploads) => prevNumberOfUploads + 1),\n    ]);\n\n    uploadImage({ newImage });\n  };\n\n  return editing ? (\n    <EditingBoxContainer testID='editing'>\n      <EditingBoxHeader>\n        <EditingBoxHeaderTitle>{t('Editing Message')}</EditingBoxHeaderTitle>\n        <IconSquare\n          icon={iconClose}\n          onPress={() => {\n            resetInput();\n            clearEditingState();\n          }}\n        />\n      </EditingBoxHeader>\n      {renderInputContainer()}\n    </EditingBoxContainer>\n  ) : (\n    renderInputContainer()\n  );\n};\n"]}